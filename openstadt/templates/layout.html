<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>{% block title %}OpenStadt{% endblock %}</title>
    <meta name="description" content="{% block description %}Offene Stadtdaten für alle{% endblock %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/static/img/favicon.ico" type="image/x-icon">

    <!-- Fonts: Neo-Brutalist -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/css/vuetify.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.x/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/dist/tabler-icons.min.css">
    <link rel="stylesheet" href="/static/css/app.css">

    {% block css %}{% endblock %}
    {% block head_js %}{% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">
<!-- Brutalist Navbar -->
<nav class="brutalist-navbar">
    <a href="/" class="brutalist-navbar-brand">
        <div class="brutalist-navbar-logo">
            <i class="ti ti-building"></i>
        </div>
        <span class="brutalist-navbar-title">OpenStadt</span>
    </a>

    <div class="brutalist-navbar-links">
        <a href="/" class="brutalist-nav-link">
            <i class="ti ti-home"></i> Start
        </a>
        <a href="https://github.com/level09/openstadt" target="_blank" class="brutalist-nav-link">
            <i class="ti ti-brand-github"></i> GitHub
        </a>
        {% if current_user.is_authenticated %}
        <a href="/dashboard" class="brutalist-nav-link btn-primary">Dashboard</a>
        {% else %}
        <a href="/login" class="brutalist-nav-link btn-primary">Anmelden</a>
        {% endif %}
    </div>

    <button class="brutalist-nav-toggle"><i class="ti ti-menu-2"></i></button>
</nav>

<v-app id="app" style="padding-top: 64px;">
    <v-layout class="rounded rounded-md">
        {% if current_user.is_authenticated %}
        <!-- Admin Navigation Drawer -->
        <v-navigation-drawer v-model="drawer" width="260" class="brutalist">
            <div style="padding: 16px; background: #FFCC00; border-bottom: 3px solid #000;">
                <div style="font-weight: 700; font-size: 14px; text-transform: uppercase;">Administration</div>
            </div>
            <v-list density="compact" nav>
                <v-list-item href="/dashboard" prepend-icon="mdi-view-dashboard" title="Übersicht"></v-list-item>
                <v-list-item href="/dashboard/cities" prepend-icon="mdi-city" title="Städte"></v-list-item>
                <v-list-item href="/dashboard/import" prepend-icon="mdi-database-import" title="Daten Import"></v-list-item>

                {% if current_user.has_role('admin') %}
                <v-divider class="my-2"></v-divider>
                <v-list-subheader>System</v-list-subheader>
                <v-list-item href="/admin/users" prepend-icon="mdi-account-multiple" title="Benutzer"></v-list-item>
                <v-list-item href="/admin/roles" prepend-icon="mdi-shield-account" title="Rollen"></v-list-item>
                <v-list-item href="/admin/activities" prepend-icon="mdi-history" title="Aktivitäten"></v-list-item>
                {% endif %}

                <v-divider class="my-2"></v-divider>
                <v-list-item href="/change" prepend-icon="mdi-key" title="Passwort ändern"></v-list-item>
                <v-list-item href="/logout" prepend-icon="mdi-logout" title="Abmelden" base-color="error"></v-list-item>
            </v-list>
        </v-navigation-drawer>
        {% endif %}

        <!-- Main Content -->
        <v-main style="background: #FFF8E7;">
            {% block content %}
            {% endblock %}
        </v-main>

        <!-- Flash messages -->
        {% set messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <v-snackbar v-model="showFlash" :timeout="5000" color="${flashType}" location="top">
            ${ flashMessage }
            <template v-slot:actions>
                <v-btn variant="text" @click="showFlash = false">Schließen</v-btn>
            </template>
        </v-snackbar>
        {% endif %}
    </v-layout>
</v-app>

<!-- Scripts -->
<script src="/static/js/vue.min.js"></script>
<script src="/static/js/config.js"></script>
<script src="/static/js/vuetify.min.js"></script>
<script src="/static/js/axios.min.js"></script>

<script>
    // Flash message data
    {% if messages %}
    const flashMessages = {{ messages | tojson | safe }};
    {% else %}
    const flashMessages = [];
    {% endif %}

    // Base app mixin
    const layoutMixin = {
        data() {
            return {
                drawer: window.innerWidth >= 960,
                showFlash: flashMessages.length > 0,
                flashType: flashMessages.length > 0 ? flashMessages[0][0] : 'info',
                flashMessage: flashMessages.length > 0 ? flashMessages[0][1] : '',
            };
        }
    };
</script>

{% block js %}{% endblock %}
</body>
</html>
